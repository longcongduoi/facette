// https://facette.io/ Version 0.1.0. Copyright 2018 Vincent Batoufflet.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.boula=e(t.d3)}(this,function(o){"use strict";var e={axes:{x:{max:null,min:null,ticks:{count:10,font:{size:10},size:6}},y:{center:!1,max:null,min:null,stack:!1,ticks:{count:3,font:{size:10},format:o.format(".2r")}}},colors:["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#8085e8","#8d4653","#91e8e1"],events:{afterDraw:null,handleEvent:null},font:{color:null,family:null},margin:24,titles:{main:{size:16,text:null},subtitle:{size:12,text:null}},type:"area"};var t=function(){this.__data__=[],this.size=0};var i=function(t,e){return t===e||t!=t&&e!=e};var a=function(t,e){for(var n=t.length;n--;)if(i(t[n][0],e))return n;return-1},r=Array.prototype.splice;var n=function(t){var e=this.__data__,n=a(e,t);return!(n<0||(n==e.length-1?e.pop():r.call(e,n,1),--this.size,0))};var c=function(t){var e=this.__data__,n=a(e,t);return n<0?void 0:e[n][1]};var s=function(t){return-1<a(this.__data__,t)};var f=function(t,e){var n=this.__data__,r=a(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=t,u.prototype.delete=n,u.prototype.get=c,u.prototype.has=s,u.prototype.set=f;var h=u;var l=function(){this.__data__=new h,this.size=0};var v=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var p=function(t){return this.__data__.get(t)};var g=function(t){return this.__data__.has(t)},y="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function d(t,e){return t(e={exports:{}},e.exports),e.exports}var x="object"==typeof y&&y&&y.Object===Object&&y,m="object"==typeof self&&self&&self.Object===Object&&self,b=x||m||Function("return this")(),_=b.Symbol,j=Object.prototype,w=j.hasOwnProperty,O=j.toString,S=_?_.toStringTag:void 0;var k=function(t){var e=w.call(t,S),n=t[S];try{var r=!(t[S]=void 0)}catch(t){}var i=O.call(t);return r&&(e?t[S]=n:delete t[S]),i},z=Object.prototype.toString;var A=function(t){return z.call(t)},T="[object Null]",F="[object Undefined]",E=_?_.toStringTag:void 0;var P=function(t){return null==t?void 0===t?F:T:E&&E in Object(t)?k(t):A(t)};var D=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},B="[object AsyncFunction]",M="[object Function]",R="[object GeneratorFunction]",U="[object Proxy]";var $,G=function(t){if(!D(t))return!1;var e=P(t);return e==M||e==R||e==B||e==U},L=b["__core-js_shared__"],C=($=/[^.]+$/.exec(L&&L.keys&&L.keys.IE_PROTO||""))?"Symbol(src)_1."+$:"";var I=function(t){return!!C&&C in t},W=Function.prototype.toString;var H=function(t){if(null!=t){try{return W.call(t)}catch(t){}try{return t+""}catch(t){}}return""},N=/^\[object .+?Constructor\]$/,Y=Function.prototype,q=Object.prototype,V=Y.toString,J=q.hasOwnProperty,K=RegExp("^"+V.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Q=function(t){return!(!D(t)||I(t))&&(G(t)?K:N).test(H(t))};var X=function(t,e){return null==t?void 0:t[e]};var Z=function(t,e){var n=X(t,e);return Q(n)?n:void 0},tt=Z(b,"Map"),et=Z(Object,"create");var nt=function(){this.__data__=et?et(null):{},this.size=0};var rt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},it="__lodash_hash_undefined__",ot=Object.prototype.hasOwnProperty;var at=function(t){var e=this.__data__;if(et){var n=e[t];return n===it?void 0:n}return ot.call(e,t)?e[t]:void 0},ct=Object.prototype.hasOwnProperty;var st=function(t){var e=this.__data__;return et?void 0!==e[t]:ct.call(e,t)},ft="__lodash_hash_undefined__";var ut=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=et&&void 0===e?ft:e,this};function ht(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ht.prototype.clear=nt,ht.prototype.delete=rt,ht.prototype.get=at,ht.prototype.has=st,ht.prototype.set=ut;var lt=ht;var vt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var pt=function(t,e){var n=t.__data__;return vt(e)?n["string"==typeof e?"string":"hash"]:n.map};var gt=function(t){var e=pt(this,t).delete(t);return this.size-=e?1:0,e};var yt=function(t){return pt(this,t).get(t)};var dt=function(t){return pt(this,t).has(t)};var xt=function(t,e){var n=pt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function mt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}mt.prototype.clear=function(){this.size=0,this.__data__={hash:new lt,map:new(tt||h),string:new lt}},mt.prototype.delete=gt,mt.prototype.get=yt,mt.prototype.has=dt,mt.prototype.set=xt;var bt=mt,_t=200;var jt=function(t,e){var n=this.__data__;if(n instanceof h){var r=n.__data__;if(!tt||r.length<_t-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new bt(r)}return n.set(t,e),this.size=n.size,this};function wt(t){var e=this.__data__=new h(t);this.size=e.size}wt.prototype.clear=l,wt.prototype.delete=v,wt.prototype.get=p,wt.prototype.has=g,wt.prototype.set=jt;var Ot=wt,St=function(){try{var t=Z(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var kt=function(t,e,n){"__proto__"==e&&St?St(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};var zt=function(t,e,n){(void 0===n||i(t[e],n))&&(void 0!==n||e in t)||kt(t,e,n)};var At=function(s){return function(t,e,n){for(var r=-1,i=Object(t),o=n(t),a=o.length;a--;){var c=o[s?a:++r];if(!1===e(i[c],c,i))break}return t}}(),Tt=d(function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n?b.Buffer:void 0,o=i?i.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=o?o(n):new t.constructor(n);return t.copy(r),r}}),Ft=b.Uint8Array;var Et=function(t){var e=new t.constructor(t.byteLength);return new Ft(e).set(new Ft(t)),e};var Pt=function(t,e){var n=e?Et(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var Dt=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},Bt=Object.create,Mt=function(){function n(){}return function(t){if(!D(t))return{};if(Bt)return Bt(t);n.prototype=t;var e=new n;return n.prototype=void 0,e}}();var Rt=function(e,n){return function(t){return e(n(t))}}(Object.getPrototypeOf,Object),Ut=Object.prototype;var $t=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ut)};var Gt=function(t){return"function"!=typeof t.constructor||$t(t)?{}:Mt(Rt(t))};var Lt=function(t){return null!=t&&"object"==typeof t},Ct="[object Arguments]";var It=function(t){return Lt(t)&&P(t)==Ct},Wt=Object.prototype,Ht=Wt.hasOwnProperty,Nt=Wt.propertyIsEnumerable,Yt=It(function(){return arguments}())?It:function(t){return Lt(t)&&Ht.call(t,"callee")&&!Nt.call(t,"callee")},qt=Array.isArray,Vt=9007199254740991;var Jt=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=Vt};var Kt=function(t){return null!=t&&Jt(t.length)&&!G(t)};var Qt=function(t){return Lt(t)&&Kt(t)};var Xt=function(){return!1},Zt=d(function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n?b.Buffer:void 0,o=(i?i.isBuffer:void 0)||Xt;t.exports=o}),te="[object Object]",ee=Function.prototype,ne=Object.prototype,re=ee.toString,ie=ne.hasOwnProperty,oe=re.call(Object);var ae=function(t){if(!Lt(t)||P(t)!=te)return!1;var e=Rt(t);if(null===e)return!0;var n=ie.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&re.call(n)==oe},ce={};ce["[object Float32Array]"]=ce["[object Float64Array]"]=ce["[object Int8Array]"]=ce["[object Int16Array]"]=ce["[object Int32Array]"]=ce["[object Uint8Array]"]=ce["[object Uint8ClampedArray]"]=ce["[object Uint16Array]"]=ce["[object Uint32Array]"]=!0,ce["[object Arguments]"]=ce["[object Array]"]=ce["[object ArrayBuffer]"]=ce["[object Boolean]"]=ce["[object DataView]"]=ce["[object Date]"]=ce["[object Error]"]=ce["[object Function]"]=ce["[object Map]"]=ce["[object Number]"]=ce["[object Object]"]=ce["[object RegExp]"]=ce["[object Set]"]=ce["[object String]"]=ce["[object WeakMap]"]=!1;var se=function(t){return Lt(t)&&Jt(t.length)&&!!ce[P(t)]};var fe=function(e){return function(t){return e(t)}},ue=d(function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n&&x.process,o=function(){try{return i&&i.binding&&i.binding("util")}catch(t){}}();t.exports=o}),he=ue&&ue.isTypedArray,le=he?fe(he):se;var ve=function(t,e){return"__proto__"==e?void 0:t[e]},pe=Object.prototype.hasOwnProperty;var ge=function(t,e,n){var r=t[e];pe.call(t,e)&&i(r,n)&&(void 0!==n||e in t)||kt(t,e,n)};var ye=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var c=e[o],s=r?r(n[c],t[c],c,n,t):void 0;void 0===s&&(s=t[c]),i?kt(n,c,s):ge(n,c,s)}return n};var de=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},xe=9007199254740991,me=/^(?:0|[1-9]\d*)$/;var be=function(t,e){var n=typeof t;return!!(e=null==e?xe:e)&&("number"==n||"symbol"!=n&&me.test(t))&&-1<t&&t%1==0&&t<e},_e=Object.prototype.hasOwnProperty;var je=function(t,e){var n=qt(t),r=!n&&Yt(t),i=!n&&!r&&Zt(t),o=!n&&!r&&!i&&le(t),a=n||r||i||o,c=a?de(t.length,String):[],s=c.length;for(var f in t)!e&&!_e.call(t,f)||a&&("length"==f||i&&("offset"==f||"parent"==f)||o&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||be(f,s))||c.push(f);return c};var we=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},Oe=Object.prototype.hasOwnProperty;var Se=function(t){if(!D(t))return we(t);var e=$t(t),n=[];for(var r in t)("constructor"!=r||!e&&Oe.call(t,r))&&n.push(r);return n};var ke=function(t){return Kt(t)?je(t,!0):Se(t)};var ze=function(t){return ye(t,ke(t))};var Ae=function(t,e,n,r,i,o,a){var c=ve(t,n),s=ve(e,n),f=a.get(s);if(f)zt(t,n,f);else{var u=o?o(c,s,n+"",t,e,a):void 0,h=void 0===u;if(h){var l=qt(s),v=!l&&Zt(s),p=!l&&!v&&le(s);u=s,l||v||p?u=qt(c)?c:Qt(c)?Dt(c):v?Tt(s,!(h=!1)):p?Pt(s,!(h=!1)):[]:ae(s)||Yt(s)?Yt(u=c)?u=ze(c):(!D(c)||r&&G(c))&&(u=Gt(s)):h=!1}h&&(a.set(s,u),i(u,s,r,o,a),a.delete(s)),zt(t,n,u)}};var Te=function r(i,o,a,c,s){i!==o&&At(o,function(t,e){if(D(t))s||(s=new Ot),Ae(i,o,e,a,r,c,s);else{var n=c?c(ve(i,e),t,e+"",i,o,s):void 0;void 0===n&&(n=t),zt(i,e,n)}},ke)};var Fe=function(t){return t};var Ee=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},Pe=Math.max;var De=function(o,a,c){return a=Pe(void 0===a?o.length-1:a,0),function(){for(var t=arguments,e=-1,n=Pe(t.length-a,0),r=Array(n);++e<n;)r[e]=t[a+e];e=-1;for(var i=Array(a+1);++e<a;)i[e]=t[e];return i[a]=c(r),Ee(o,this,i)}};var Be=function(t){return function(){return t}},Me=St?function(t,e){return St(t,"toString",{configurable:!0,enumerable:!1,value:Be(e),writable:!0})}:Fe,Re=800,Ue=16,$e=Date.now;var Ge=function(n){var r=0,i=0;return function(){var t=$e(),e=Ue-(t-i);if(i=t,0<e){if(++r>=Re)return arguments[0]}else r=0;return n.apply(void 0,arguments)}}(Me);var Le=function(t,e){return Ge(De(t,e,Fe),t+"")};var Ce=function(t,e,n){if(!D(n))return!1;var r=typeof e;return!!("number"==r?Kt(n)&&be(e,n.length):"string"==r&&e in n)&&i(n[e],t)};var Ie=function(c){return Le(function(t,e){var n=-1,r=e.length,i=1<r?e[r-1]:void 0,o=2<r?e[2]:void 0;for(i=3<c.length&&"function"==typeof i?(r--,i):void 0,o&&Ce(e[0],e[1],o)&&(i=r<3?void 0:i,r=1),t=Object(t);++n<r;){var a=e[n];a&&c(t,a,n,i)}return t})}(function(t,e,n){Te(t,e,n)});Ie.merge;function We(t){return this.update(t),this}Object.assign(We.prototype,{destroy:function(){We.components.execute.call(this,"destroy")},draw:function(){var e=this;this.ctx.save(),["update","layout","beforeDraw","draw","afterDraw"].forEach(function(t){return We.components.execute.call(e,t)}),this.ctx.restore(),this.config.events.afterDraw&&this.config.events.afterDraw()},update:function(t){this.config=Ie({},e,t),null===this.config.font.color&&(this.config.font.color=getComputedStyle(document.body).color),null===this.config.font.family&&(this.config.font.family=getComputedStyle(document.body).fontFamily),this.height=this.config.bindTo.parentNode.clientHeight,this.width=this.config.bindTo.parentNode.clientWidth,this.canvas=o.select(this.config.bindTo).attr("height",this.height).attr("width",this.width).node(),this.ctx=this.canvas.getContext("2d"),We.helpers.hidpiScale(this)}});var He,Ne,Ye,qe,Ve,Je={_components:[],execute:function(e){var n=this;Je._components.forEach(function(t){t.hasOwnProperty(e)&&t[e].call(n)})},register:function(t){Je._components.push(t)}};return We.helpers={hidpiScale:function(t){var e=devicePixelRatio||1;if(1!=e){var n=t.canvas.height,r=t.canvas.width;t.canvas.height*=e,t.canvas.width*=e,Object.assign(t.canvas.style,{height:n+"px",width:r+"px"}),t.ctx.scale(e,e)}},toRGBA:function(t,e){var n=o.rgb(t);return"rgba("+n.r+", "+n.g+", "+n.b+", "+("number"==typeof e?e:1)+")"}},We.components=Je,(He=We).components.register({layout:function(){this.ctx.clearRect(0,0,this.width,this.height),this.area={left:this.config.margin,top:this.config.margin,height:this.height-2*this.config.margin,width:this.width-2*this.config.margin}},beforeDraw:function(){Object.assign(this.area,{left:this.width-this.area.width-this.config.margin,top:this.height-this.area.height-this.config.margin}),this.ctx.translate(this.area.left,this.area.top)},draw:function(){var n=this,t=this.yScale.ticks(this.config.axes.y.ticks.count);this.ctx.beginPath(),this.ctx.lineWidth=1,this.ctx.strokeStyle=He.helpers.toRGBA(this.config.font.color,.1),t.forEach(function(t){var e=n.yScale(t);n.ctx.moveTo(0,e),n.ctx.lineTo(n.area.width,e)}),this.ctx.stroke()}}),(Ne=We).components.register({afterDraw:function(){var n=this;this.ctx.beginPath(),this.ctx.font=this.config.axes.x.ticks.font.size+"px "+this.config.font.family,this.ctx.lineWidth=1,this.ctx.strokeStyle=Ne.helpers.toRGBA(this.config.font.color,.25),this.ctx.textAlign="center",this.ctx.textBaseline="hanging",this.xScale.ticks(this.config.axes.x.ticks.count).forEach(function(t){var e=n.xScale(t);n.ctx.moveTo(e,n.area.height),n.ctx.lineTo(e,n.area.height+n.config.axes.x.ticks.size),n.ctx.fillStyle=n.config.font.color,n.ctx.fillText(n.xFormat(t),e,n.area.height+1.35*n.config.axes.x.ticks.size)}),this.ctx.stroke(),this.ctx.moveTo(0,this.area.height),this.ctx.lineTo(this.area.width,this.area.height),this.ctx.stroke(),this.ctx.font=this.config.axes.y.ticks.font.size+"px "+this.config.font.family,this.ctx.textAlign="right",this.ctx.textBaseline="middle",this.yScale.ticks(this.config.axes.y.ticks.count).forEach(function(t){n.ctx.fillStyle=n.config.font.color,n.ctx.fillText(n.yFormat(t),-n.config.axes.x.ticks.size,n.yScale(t))})}}),We.components.register({update:function(){switch(this.config.axes.y.stack){case"normal":case"percent":var r={},t=[];this.config.series.forEach(function(n){n.points&&n.points.forEach(function(t){var e=1e3*t[0];r[e]||(r[e]={date:e}),r[e][n.name]=t[1]}),t.push(n.name)}),this.config.axes.y.stack;var e=o.stack().keys(t).order(o.stackOrderReverse);this.data=e(Object.values(r)).map(function(t){return t.map(function(t){return{x:t.data.date,y0:t[0],y1:t[1]}})});break;default:this.data=this.config.series.map(function(t){return t.points?t.points.map(function(t){return{x:1e3*t[0],y1:t[1]}}):[]})}}}),We.components.register({destroy:function(){var e=this;this.config.events.handleEvent&&["mouseenter","mouseleave","mousemove"].forEach(function(t){e.canvas.removeEventListener(t,e.config.events.handleEvent)})},afterDraw:function(){var e=this;this.config.events.handleEvent&&["mouseenter","mouseleave","mousemove"].forEach(function(t){e.canvas.addEventListener(t,e.config.events.handleEvent.bind(e))})}}),Ye={layout:function(){var e=this;this.yScale=o.scaleLinear().domain(Ye._getDomain.call(this,"y","y1")).range([this.area.height,0]).nice(),this.yFormat="percent"==this.config.axes.y.stack?o.format(".0%"):this.config.axes.y.ticks.format,this.ctx.font=this.config.axes.y.ticks.font.size+"px "+this.config.font.family,this.area.width-=Math.max.apply(Math,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(this.yScale.ticks(this.config.axes.y.ticks.count).map(function(t){return e.ctx.measureText(e.yFormat(t)).width}))),this.xScale=o.scaleTime().domain(Ye._getDomain.call(this,"x","x")).range([0,this.area.width]),this.xFormat=function(t){return(o.timeSecond(t)<t?o.timeFormat(".%L"):o.timeMinute(t)<t?o.timeFormat(":%S"):o.timeHour(t)<t?o.timeFormat("%H:%M"):o.timeDay(t)<t?o.timeFormat("%H:00"):o.timeMonth(t)<t?o.timeFormat("%a %d"):o.timeYear(t)<t?o.timeFormat("%B"):o.timeFormat("%Y"))(t)}},_getDomain:function(t,e){var n=void 0,r=void 0;return n=null!==this.config.axes[t].min?this.config.axes[t].min:o.min(this.data,function(t){return o.min(t,function(t){return t[e]})}),r=null!==this.config.axes[t].max?this.config.axes[t].max:o.max(this.data,function(t){return o.max(t,function(t){return t[e]})}),"y"==t&&(0<n?n=0:this.config.axes.y.center&&n<0&&(n=-1*(r=Math.max(r,Math.abs(n))))),[n||0,r||1]}},We.components.register(Ye),(qe=We).components.register({draw:function(){var n=this,r=void 0;"area"==this.config.type&&(r=o.area().x(function(t){return n.xScale(t.x)}).y0(function(t){return n.yScale(t.y0||0)}).y1(function(t){return n.yScale(t.y1)}).context(this.ctx));var i=o.line().x(function(t){return n.xScale(t.x)}).y(function(t){return n.yScale(t.y1)}).context(this.ctx);this.ctx.save(),this.ctx.rect(0,0,this.area.width,this.area.height),this.ctx.clip(),this.data.forEach(function(t,e){n.config.series[e].color||(n.config.series[e].color=n.config.colors[e%n.config.colors.length]),"area"==n.config.type&&(n.ctx.beginPath(),r(t),n.ctx.fillStyle=qe.helpers.toRGBA(n.config.series[e].color,.65),n.ctx.fill()),n.ctx.beginPath(),i(t),n.ctx.strokeStyle=n.config.series[e].color,n.ctx.lineWidth=1.5,n.ctx.stroke()}),this.ctx.restore()}}),(Ve=We).components.register({layout:function(){var t=0;this.config.titles.main.text&&(t+=this.config.titles.main.size),this.config.titles.subtitle.text&&(t+=this.config.titles.subtitle.size),0<t&&(this.area.height-=t+.5*this.config.margin,this.yScale.range([this.area.height,0]))},draw:function(){if(this.config.titles.main.text||this.config.titles.subtitle.text){var t=-1.5*this.config.margin,e=0;this.ctx.save(),this.ctx.textAlign="center",this.config.titles.main.text&&(this.ctx.font=this.config.titles.main.size+"px "+this.config.font.family,this.ctx.fillStyle=this.config.font.color,this.ctx.fillText(this.config.titles.main.text,this.area.width/2,t),e+=this.config.titles.main.size+.125*this.config.margin),this.config.titles.subtitle.text&&(this.ctx.font=this.config.titles.subtitle.size+"px "+this.config.font.family,this.ctx.fillStyle=Ve.helpers.toRGBA(this.config.font.color,.5),this.ctx.fillText(this.config.titles.subtitle.text,this.area.width/2,t+e)),this.ctx.restore()}}}),We});